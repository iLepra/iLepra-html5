iLepra=function(){var a=null,c=null,b=null,d=null,e=null,g=null,f=null,h=function(a){iLepra.captchaURL="http://leprosorium.ru"+/img alt="captcha" src="(.+?)"/g.exec(a)[1];iLepra.loginCode=/<input type="hidden" name="logincode" value="(.+?)"/g.exec(a)[1]},i=function(a){a=a.replace(/\n+/g,"");a=a.replace(/\r+/g,"");a=a.replace(/\t+/g,"");iLepra.postVoteWTF=/wtf_vote = '(.+?)'/g.exec(a)[1];iLepra.myStuffWTF=/mythingsHandler.wtf = '(.+?)'/g.exec(a)[1];iLepra.chat.wtf=/chatHandler.wtf = '(.+?)'/g.exec(a)[1];
iLepra.username=/<div id="greetings" class="columns_wrapper">.+?<a href=".+?">(.+?)<\/a>/g.exec(a)[1];iLepra.userSubLepras=[];for(var b=/<div class="sub"><strong class="logo"><a href="(.+?)" title="(.*?)"><img src="(.+?)" alt=".+?" \/>.+?<div class="creator">.+?<a href=".*?\/users\/.+?">(.+?)<\/a>/g,c=b.exec(a);null!=c;)iLepra.userSubLepras.push({name:c[2],creator:c[4],link:c[1],logo:c[3]}),c=b.exec(a)};return{events:{init:"iLepraInit",ready:"iLepraReady",update:"iLepraUpdate",error:"iLepraError"},
config:{loadImages:!0,screenBiggest:0,postIncrement:20,defaultTapEvent:"tap"},isAuthenticated:!1,loginCode:null,captchaURL:null,errorMessage:null,username:null,userSubLepras:null,inboxNewPosts:null,inboxNewComments:null,karma:null,rating:null,voteweight:null,myNewComments:null,myNewPosts:null,latestPosts:null,postCount:null,postVoteWTF:null,myStuffPosts:null,myStuffWTF:null,favouritePosts:null,inboxPosts:null,init:function(){this.config.screenBiggest=window.screen.width>window.screen.height?window.screen.width:
window.screen.height;$.get("http://leprosorium.ru",function(a){0<a.indexOf('<input type="password"')?(h(a),iLepra.isAuthenticated=!1):(iLepra.isAuthenticated=!0,i(a));$(document).trigger(iLepra.events.init)})},tryLogin:function(a){a.logincode=this.loginCode;$.post("http://leprosorium.ru/login/",a,function(a){0<a.indexOf('class="error"')?(iLepra.errorMessage=/<div class="error">(.+?)<\/div>/g.exec(a)[1],h(a),$(document).trigger(iLepra.events.error)):(i(a),$(document).trigger(iLepra.events.ready))})},
getNewsCounters:function(){$.ajax({url:"http://leprosorium.ru/api/lepropanel",dataType:"json",error:function(a){a=$.parseJSON(a.responseText);iLepra.inboxNewPosts=parseInt(a.inboxunreadposts);iLepra.inboxNewComments=parseInt(a.inboxunreadcomms);iLepra.karma=parseInt(a.karma);iLepra.rating=parseInt(a.rating);iLepra.voteweight=parseInt(a.voteweight);iLepra.myNewComments=parseInt(a.myunreadcomms);iLepra.myNewPosts=parseInt(a.myunreadposts);$(document).trigger(iLepra.events.update)}})},getLastPosts:function(b){if(null==
b||"undefined"==typeof b)b=!1;var c=(new Date).getTime();null!=a&&3E5>Math.abs(c-a)&&0<iLepra.latestPosts.length&&!b?$(document).trigger(iLepra.events.ready):(iLepra.postCount=0,$.post("http://leprosorium.ru/idxctl/",{from:iLepra.postCount},function(b){a=(new Date).getTime();b=$.parseJSON(b);iLepra.latestPosts=[];iLepra.util.processJSONPosts(b.posts,iLepra.latestPosts);$(document).trigger(iLepra.events.ready)}))},getMorePosts:function(){iLepra.postCount+=42;$.post("http://leprosorium.ru/idxctl/",
{from:iLepra.postCount},function(a){a=$.parseJSON(a);iLepra.util.processJSONPosts(a.posts,iLepra.latestPosts);$(document).trigger(iLepra.events.ready)})},switchLayout:function(a){$.post("http://leprosorium.ru/threshold/",{showonindex:a,selected_threshold:"all"},function(){iLepra.getLastPosts(!0)})},getMyStuff:function(a){if(null==a||"undefined"==typeof a)a=!1;var b=(new Date).getTime();iLepra.myNewComments==d&&iLepra.myNewPosts==e&&null!=c&&3E5>Math.abs(b-c)&&0<iLepra.myStuffPosts.length&&!a?$(document).trigger(iLepra.events.ready):
$.get("http://leprosorium.ru/my/",function(a){e=iLepra.myNewPosts;d=iLepra.myNewComments;c=(new Date).getTime();iLepra.myStuffPosts=[];iLepra.util.processHTMLPosts(a,iLepra.myStuffPosts,void 0);$(document).trigger(iLepra.events.ready)})},getFavourites:function(){null!=iLepra.favouritePosts&&0<iLepra.favouritePosts.length?$(document).trigger(iLepra.events.ready):$.get("http://leprosorium.ru/my/favourites/",function(a){iLepra.favouritePosts=[];iLepra.util.processHTMLPosts(a,iLepra.favouritePosts,"fav");
$(document).trigger(iLepra.events.ready)})},getInbox:function(a){if(null==a||"undefined"==typeof a)a=!1;var c=(new Date).getTime();iLepra.inboxNewComments==g&&iLepra.inboxNewPosts==f&&null!=b&&3E5>Math.abs(c-b)&&0<iLepra.inboxPosts.length&&!a?$(document).trigger(iLepra.events.ready):$.get("http://leprosorium.ru/my/inbox/",function(a){f=iLepra.inboxNewPosts;g=iLepra.inboxNewComments;b=(new Date).getTime();iLepra.inboxPosts=[];iLepra.util.processHTMLPosts(a,iLepra.inboxPosts,"inbox");$(document).trigger(iLepra.events.ready)})}}}();
iLepra.util=function(){return{processHTMLPosts:function(a,c,b){for(var a=a.replace(/\n+/g,""),a=a.replace(/\r+/g,""),a=a.replace(/\t+/g,""),d=/<div class="post.+?id="(.+?)".+?class="dt">(.+?)<\/div>.+?<a href=".*?\/users\/.+?".*?>(.+?)<\/a>,(.+?)<span>.+?<a href=".*?\/(comments|inbox)\/.+?">(.+?)<\/span>.+?.+?(<div class="vote".+?><em>(.+?)<\/em><\/span>|<\/div>)(<a href="#".+?class="plus(.*?)">.+?<a href="#".+?class="minus(.*?)">|<\/div>)/g,e=d.exec(a);null!=e;){var g=e[2],f=/img src="(.+?)"/g,h=
f.exec(g),i="";if(null!=h){i="http://src.sencha.io/80/80/"+h[1];g=g.replace(h[1],"http://src.sencha.io/"+iLepra.config.screenBiggest+"/"+h[1]);for(h=f.exec(g);null!=h;)g=g.replace(e[1],"http://src.sencha.io/"+iLepra.config.screenBiggest+"/"+h[1]),h=f.exec(g)}f=g.replace(/(<([^>]+)>)/ig," ").substr(0,140);140==f.length&&(f+="..");var h=e[3].split("</a> \u0432 "),j=h[1]?h[1].replace(/(<([^>]+)>)/ig,""):"",k=0;null!=e[9]&&0<e[9].length?k=1:null!=e[10]&&0<e[10].length&&(k=-1);e={id:e[1].replace("p",""),
body:g,rating:e[8],user:h[0],domain_url:j,when:e[4],comments:e[6].replace(/(<([^>]+)>)/ig,"").replace(/\u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430.+?(\s|$)/g,"").replace(/ \u043d\u043e\u0432.+/g,""),image:i,text:f,type:b,vote:k};c.push(e);e=d.exec(a)}},processJSONPosts:function(a,c){for(var b in a){var d={},e=/img src="(.+?)"/g,g=e.exec(a[b].body),f="";if(null!=g){f="http://src.sencha.io/80/80/"+g[1];a[b].body=a[b].body.replace(g[1],"http://src.sencha.io/"+iLepra.config.screenBiggest+"/"+g[1]);
for(g=e.exec(a[b].body);null!=g;)a[b].body=a[b].body.replace(g[1],"http://src.sencha.io/"+iLepra.config.screenBiggest+"/"+g[1]),g=e.exec(a[b].body)}e=a[b].body.replace(/(<([^>]+)>)/ig," ").substr(0,140);140==e.length&&(e+="..");d.id=a[b].id;d.body=a[b].body;d.rating=a[b].rating;d.domain_url=a[b].domain_url;d.image=f;d.text=e;d.user=a[b].login;d.comments=a[b].comm_count+" / "+a[b].unread;d.wrote=(1==a[b].gender?"\u041d\u0430\u043f\u0438\u0441\u0430\u043b ":"\u041d\u0430\u043f\u0438\u0441\u0430\u043b\u0430 ")+
a[b].user_rank+" "+a[b].login;d.when=a[b].textdate+" \u0432 "+a[b].posttime;d.vote=parseInt(a[b].user_vote);-1==c.indexOf(d)&&c.push(d)}}}}();iLepra.ui=function(){return{showError:function(a){$("<div class='errorMessage ui-overlay-shadow ui-body-e ui-corner-all'>"+a+"</div>").css({top:$(window).scrollTop()+100}).appendTo($.mobile.activePage).delay(1200).fadeOut(800,function(){$(this).remove()})}}}();
iLepra.post=function(){return{current:null,comments:null,newComments:null,getComments:function(a,c){"undefined"==typeof a&&(a=iLepra.post.current.id);"undefined"==typeof c&&(c=iLepra.post.current.type);var b;"inbox"==c?b="http://leprosorium.ru/my/inbox/"+a:(b="leprosorium.ru",0<iLepra.post.current.domain_url.length&&(b=iLepra.post.current.domain_url),b="http://"+b+"/comments/"+a);$.get(b,function(a){a=a.replace(/\n+/g,"");a=a.replace(/\r+/g,"");a=a.replace(/\t+/g,"");iLepra.post.comments=[];iLepra.post.newComments=
[];var b=/wtf_vote = '(.+?)'/gi.exec(a);iLepra.post.current.wtf={comment:/commentsHandler.wtf = '(.+?)'/g.exec(a)[1],vote:b!=null?b[1]:null};for(var b=/<div id="(.+?)" class="post tree(.+?)"><div class="dt">(.+?)<\/div>.+?<a href=".*?\/users\/.+?">(.+?)<\/a>,(.+?)<span>.+?(<div class="vote".+?><em>(.+?)<\/em><\/span>|<\/div>)(<a href="#".+?class="plus(.*?)">.+?<a href="#".+?class="minus(.*?)">|<\/div>)/g,a=a.substr(a.indexOf('id="js-commentsHolder"')),c=b.exec(a);c!=null;){for(var f=c[3],h=/img src="(.+?)"/g,
i=h.exec(f);i!=null;){f=f.replace(i[1],"http://src.sencha.io/"+iLepra.config.screenBiggest+"/"+i[1]);i=h.exec(f)}h=0;c[9]!=null&&c[9].length>0?h=1:c[10]!=null&&c[10].length>0&&(h=-1);var j=0,i=/indent_(.+?) /.exec(c[2]);i!=null&&(j=i[1]);j>15&&(j=15);f=f.replace(/<p.*?>/gi,"");f=f.replace(/<\/p>/gi,"");f=f.replace(/<nonimg/ig,"<img");c={id:c[1],isNew:c[2].indexOf("new")!=-1?1:0,indent:j,text:f,rating:c[7],user:c[4],when:c[5],vote:h};iLepra.post.comments.push(c);c.isNew&&iLepra.post.newComments.push(c);
c=b.exec(a)}$(document).trigger(iLepra.events.ready)})},addComment:function(a,c){var b="http://",b=""!=iLepra.post.current.domain_url&&"inbox"!=iLepra.post.current.type?b+iLepra.post.current.domain_url:b+"leprosorium.ru",d={wtf:iLepra.post.current.wtf.comment,pid:iLepra.post.current.id,comment:a};"undefined"!=typeof c&&null!=c&&(d.replyto=c);$.post(b+"/commctl/",d,function(a){a=$.parseJSON(a);a.status=="ERR"?$(document).trigger(iLepra.events.error):iLepra.post.getComments()})},voteComment:function(a,
c){var b="http://",b=""!=iLepra.post.current.domain_url?b+iLepra.post.current.domain_url:b+"leprosorium.ru";$.post(b+"/rate/",{type:0,wtf:iLepra.post.current.wtf.vote,post_id:iLepra.post.current.id,id:a,value:c},function(){})},votePost:function(a,c){var b="http://",b=""!=iLepra.post.current.domain_url?b+iLepra.post.current.domain_url:b+"leprosorium.ru";$.post(b+"/rate/",{type:1,wtf:iLepra.postVoteWTF,id:a,value:c},function(){})}}}();
iLepra.profile=function(){return{data:null,getProfile:function(a){$.get("http://leprosorium.ru/users/"+a,function(c){var c=c.replace(/\n+/g,""),c=c.replace(/\r+/g,""),c=c.replace(/\t+/g,""),b=/<table class="userpic"><tbody><tr><td><img src="(.+?)".+?\/>/g.exec(c),b=b?b[1]:"",d=/<div class="userregisterdate">(.+?)<\/div>/g.exec(c)[1].replace(/\./g,"").split(", "),e=d[0],d=d[1],g=/<div class="userbasicinfo"><h3>(.+?)<\/h3>/g.exec(c)[1],f=/<div class="userego">(.+?)<\/div>/g.exec(c)[1],h=/<span class="rating" id="js-user_karma".+?><em>(.+?)<\/em>/g.exec(c)[1],
i=/<div class="userstat userrating">(.+?)<\/div>/g.exec(c),j=/<div class="userstat uservoterate">\u0412\u0435\u0441 \u0433\u043e\u043b\u043e\u0441\u0430&nbsp;&#8212; (.+?)<br.*?>\u0413\u043e\u043b\u043e\u0441\u043e\u0432 \u0432 \u0434\u0435\u043d\u044c&nbsp;&#8212; (.+?)<\/div>/g.exec(c),i=i[1].replace(/(<([^>]+)>)/ig," "),j="\u0412\u0435\u0441 \u0433\u043e\u043b\u043e\u0441\u0430&nbsp;&#8212; "+j[1]+",<br>\u0413\u043e\u043b\u043e\u0441\u043e\u0432 \u0432 \u0434\u0435\u043d\u044c&nbsp;&#8212; "+j[2],
k=/<div class="userstory">(.+?)<\/div>/g.exec(c),k=null!=k?k[1]:"",c=/<div class="usercontacts">(.+?)<\/div>/g.exec(c)[1].split(/<br.*?>/);iLepra.profile.data={username:a,userpic:b,number:e,regDate:d,fullName:g,location:f,karma:h,userstat:i,votestat:j,contacts:c,description:k};$(document).trigger(iLepra.events.ready)})}}}();
iLepra.sub=function(){return{list:null,posts:null,fetch:!0,postCount:0,getList:function(){$.get("http://leprosorium.ru/underground/",function(a){a=a.replace(/\n+/g,"");a=a.replace(/\r+/g,"");a=a.replace(/\t+/g,"");iLepra.sub.list=[];for(var c=/<strong class="jj_logo"><a href="(.+?)"><img src="(.+?)" alt="(.*?)" \/>.+?<a href=".*?\/users\/.+?">(.+?)<\/a>/g,b=c.exec(a);null!=b;)iLepra.sub.list.push({name:b[3]?b[3]:b[1],creator:b[4],link:b[1],logo:b[2]}),b=c.exec(a);$(document).trigger(iLepra.events.ready)})},
getPosts:function(a){iLepra.sub.postCount=0;$.post(a+"/idxctl/",{from:iLepra.sub.postCount},function(a){a=$.parseJSON(a);iLepra.sub.posts=[];iLepra.util.processJSONPosts(a.posts,iLepra.sub.posts);$(document).trigger(iLepra.events.ready)})},getMorePosts:function(a){iLepra.sub.postCount+=42;$.post(a+"/idxctl/",{from:iLepra.sub.postCount},function(a){a=$.parseJSON(a);iLepra.util.processJSONPosts(a.posts,iLepra.sub.posts);$(document).trigger(iLepra.events.ready)})}}}();
iLepra.gov=function(){return{president:null,time:null,ministers:null,banned:null,getCurrent:function(){$.get("http://leprosorium.ru/democracy/",function(a){a=a.replace(/\n+/g,"");a=a.replace(/\r+/g,"");a=a.replace(/\t+/g,"");a=/<div id="president"><a href=".+?">(.+?)<\/a><p>.+?<br \/>(.+?)<\/p><\/div>/g.exec(a);iLepra.gov.president=a[1];iLepra.gov.time=a[2];$(document).trigger(iLepra.events.ready)})}}}();
iLepra.chat=function(){var a=function(){var a="";if(0<iLepra.chat.messages.length){var b=0,d;for(d in iLepra.chat.messages)parseInt(iLepra.chat.messages[d].id)>b&&(b=parseInt(iLepra.chat.messages[d].id));0!=b&&(a=b)}return a};return{messages:[],wtf:null,defaultKey:"leprosorium.ru/",getMessages:function(){var c=a();$.post("http://leprosorium.ru/chatctl/",{wtf:iLepra.chat.wtf,key:iLepra.chat.defaultKey,last:c},function(a){var a=$.parseJSON(a),c;for(c in a.messages)-1==iLepra.chat.messages.indexOf(a.messages[c])&&
iLepra.chat.messages.push(a.messages[c]);$(document).trigger(iLepra.events.ready)})},sendMessage:function(c){var b=a();$.post("http://leprosorium.ru/chatctl/",{wtf:iLepra.chat.wtf,key:iLepra.chat.defaultKey,last:b,body:c},function(a){var a=$.parseJSON(a),b;for(b in a.messages)-1==iLepra.chat.messages.indexOf(a.messages[b])&&iLepra.chat.messages.push(a.messages[b]);$(document).trigger(iLepra.events.ready)})}}}();
