var borderColors="#000000,#660000,#cc3333,#663399,#0066cc,#66cccc,#669900,#666600,#cccc33,#ffcc33,#ff6600,#996633,#999999,#cccccc,#333333".split(","),postTemplate='            <li data-icon="false">                <a href="#" class="postListItem" data-id="<%= id %>">                    <% if(text.length < 5 && iLepra.config.loadImages && image.length > 0){ %>                        <div>                            <img src="<%= image.replace("http://src.sencha.io/80/80/", "http://src.sencha.io/"+iLepra.config.screenBiggest+"/") %>" />                        </div>                    <% }else{ %>                        <% if(iLepra.config.loadImages && image.length > 0){ %>                            <img src="<%= image %>" class="postThumb" />                        <% } %>                        <h3 style="white-space:normal; font-weight:normal;"><%= text %></h3>                        <p><% if(domain_url != ""){ %><%= domain_url %> <% } %></p>                    <% } %>                </a>            </li>            <li data-role="list-divider" class="postInfo" data-user="<%= user %>">                <img />                <b><%= user %></b>,                 <span style="font-size:80%;">                <img src="../css/img/comment_16.png" class="iconImage" />                <% if(comments.indexOf("/") != -1){ %>                <b><%= comments %></b>,                <% }else{ %>                <%= comments %>,                <% } %>                <%= when %></span>                <% if(rating != undefined && rating.length > 0 && rating != 0){ %>,                     <span style="font-weight: bold; color:                     <% if( rating >= 0 ){ %>#157B25<% }else{ %>                        #824E48<% } %>                    "><%= rating %></span>                 <% } %>            </li>',
subsTemplate='            <li>                <a href="#" class="subListItem" data-link="<%= link %>">                    <% if(iLepra.config.loadImages){ %><img src="<%= logo %>" class="postThumb" /><% } %>                    <h1><%= name %></h1>                    <p><%= creator %></p>                </a>            </li>',commentTemplate='            <li data-id="<%= id %>" data-user="<%= user %>" <% if (isNew == 1){ %>class="new" data-theme="d"<% } %>             style="margin-left: <%= (5*indent) %>px; border-left: 3px solid <%= borderColors[indent] %>;"            >                <p class="commentText"><%= text %></p>                <div style="display:none;" class="commentsMenu">                    <a href="#" class="reply"><img src="../css/img/reply_32.png" /></a>                    <a href="#" class="voteup" style="float:right;                     <% if(vote == 1){ %>opacity: 1;<% }else{ %> opacity: 0.3; <% } %>                    "><img src="../css/img/voteup_32.png" /></a>                    <a href="#" class="votedown" style="float:right;                     <% if(vote == -1){ %>opacity: 1;<% }else{ %> opacity: 0.3; <% } %>                    "><img src="../css/img/votedown_32.png" /></a>                </div>            </li>            <li data-role="list-divider" class="postInfo" data-user="<%= user %>"            style="margin-left: <%= (5*indent) %>px; border-left: 3px solid <%= borderColors[indent] %>;"            >                <img />                <b><%= user %></b>,                 <%= when %></span>                <% if(rating != undefined && rating.length > 0 && rating != 0){ %>,                     <span style="font-weight: bold; color:                     <% if( rating >= 0 ){ %>#157B25<% }else{ %>                        #824E48<% } %>                    "><%= rating %></span>                 <% } %>            </li>',
chatTemplate='            <li data-icon="false"  class="chatMessage commentText" data-user="<%= user_login %>">                <p class="commentText"><%= body %></p>            </li>            <li data-role="list-divider" class="postInfo">                <b><%= user_login %></b>,                 <%= createdate %></span>            </li>';(function(){window.isOnline=function(){var a=navigator.network.connection.type;return a==Connection.NONE||a==Connection.UNKNOWN?!1:!0}})();
document.addEventListener("deviceready",function(){$.support.cors=!0;$.mobile.allowCrossDomainPages=!0;$.mobile.pushStateEnabled=!1;$.mobile.loadingMessageTextVisible=!0;$.mobile.loadingMessage="\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c\u0441\u044f ...";$.mobile.page.prototype.options.backBtnText="\u041d\u0430\u0437\u0430\u0434";$.mobile.fixedtoolbar.prototype.options.tapToggle=!1;$.mobile.defaultPageTransition="none";$.mobile.defaultDialogTransition="none";var a=function(a){"undefined"==
typeof a&&(a=!1);$(document).bind(iLepra.events.ready,function(d){$(document).unbind(d);$.mobile.changePage((a?"pages/":"")+"posts.html")});iLepra.getLastPosts()};$(document).bind(iLepra.events.init,function(b){$(document).unbind(b);iLepra.isAuthenticated?a(!0):$.mobile.changePage("pages/login.html")});$(document).on("pagecreate","#loginPage",function(){iLepra.isAuthenticated?$.mobile.changePage("pages/posts.html"):($("#captchaImage").attr("src",iLepra.captchaURL),$("#loginButton").bind(iLepra.config.defaultTapEvent,
function(){$.mobile.showPageLoadingMsg();var b={user:$("#username").val(),pass:$("#pass").val(),captcha:$("#captcha").val().toLowerCase(),save:$("#rememberme").is(":checked")?1:0};$(document).bind(iLepra.events.error,function(a){$(document).unbind(a);$.mobile.hidePageLoadingMsg();iLepra.ui.showError(iLepra.errorMessage);$("#captchaImage").attr("src",iLepra.captchaURL)});$(document).bind(iLepra.events.ready,function(b){$(document).unbind(b);$(document).unbind(iLepra.events.error);a()});iLepra.tryLogin(b)}))});
$(document).on("pageshow","#splashPage",function(){iLepra.isAuthenticated&&$.mobile.changePage("pages/posts.html")});var c=function(){window.isOnline()?iLepra.init():navigator.notification.alert("\u0414\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043a \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0443! \u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u0435\u0441\u044c \u0438 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 OK.",
c,"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!","\u041e\u041a")};c()},!1);
(function(){var a=null,c=function(){$(document).bind(iLepra.events.update,function(a){$(document).unbind(a);b()});iLepra.getNewsCounters()},b=function(){var a=$(".inboxCounter"),b=$(".mystuffCounter"),c="",c=0<iLepra.inboxNewPosts?c+(iLepra.inboxNewPosts+"/"+iLepra.inboxNewComments):0<iLepra.inboxNewComments?c+iLepra.inboxNewComments:"";""!=c?(a.text(c),a.show()):a.hide();a="";a=0<iLepra.myNewPosts?a+(iLepra.myNewPosts+"/"+iLepra.myNewComments):0<iLepra.myNewComments?a+iLepra.myNewComments:"";""!=
a?(b.text(a),b.show()):b.hide()};window.initCounters=function(){null!=a?updateNewsCounts():(a=setInterval(c,12E4),c())};window.updateNewsCounts=b})();(function(){window.handleImageError=function(a){$(a).parents("li").removeClass("ui-li-has-thumb");$(a).parent().append("&nbsp;");$(a).remove()}})();
(function(){var a=iLepra.config.postIncrement,c=null,b=null,d=function(){for(var b=a>iLepra.myStuffPosts.length?iLepra.myStuffPosts.length:a,g="",e=0;e<b;e++)g+=_.template(postTemplate,iLepra.myStuffPosts[e]);c.empty();c.append(g);try{c.listview("refresh")}catch(d){}};$(document).on("pageshow","#mystuffPage",function(){c=$("#mystuffList");b=$("#moreMystuffButton");$.mobile.showPageLoadingMsg();$(document).bind(iLepra.events.ready,function(c){$(document).unbind(c);$.mobile.hidePageLoadingMsg();d();
a<iLepra.myStuffPosts.length&&(b.show(),b.bind(iLepra.config.defaultTapEvent,function(c){c.preventDefault();c.stopPropagation();a+=a;a>=iLepra.myStuffPosts.length&&b.hide();d()}))});iLepra.getMyStuff();updateNewsCounts()})})();
(function(){var a=iLepra.config.postIncrement,c=null,b=null,d=function(){for(var b=a>iLepra.inboxPosts.length?iLepra.inboxPosts.length:a,g="",e=0;e<b;e++)g+=_.template(postTemplate,iLepra.inboxPosts[e]);c.empty();c.append(g);try{c.listview("refresh")}catch(d){}};$(document).on("pageshow","#inboxPage",function(){c=$("#inboxList");b=$("#moreInboxButton");$.mobile.showPageLoadingMsg();$(document).bind(iLepra.events.ready,function(c){$(document).unbind(c);$.mobile.hidePageLoadingMsg();d();a<iLepra.inboxPosts.length&&
(b.show(),b.bind(iLepra.config.defaultTapEvent,function(c){c.preventDefault();c.stopPropagation();a+=a;a>=iLepra.inboxPosts.length&&b.hide();d()}))});iLepra.getInbox();updateNewsCounts()})})();
(function(){$(document).on(iLepra.config.defaultTapEvent,"#postsBar",function(){$.mobile.changePage("posts.html",{transition:"none"})});$(document).on(iLepra.config.defaultTapEvent,"#mystuffBar",function(){$.mobile.changePage("mystuff.html",{transition:"none"})});$(document).on(iLepra.config.defaultTapEvent,"#inboxBar",function(){$.mobile.changePage("inbox.html",{transition:"none"})});$(document).on(iLepra.config.defaultTapEvent,"#moreBar",function(){$.mobile.changePage("more.html",{transition:"none"})})})();
(function(){var a=iLepra.config.postIncrement,c=null,b=null,d=function(){for(var b=a>iLepra.latestPosts.length?iLepra.latestPosts.length:a,e="",d=0;d<b;d++)e+=_.template(postTemplate,iLepra.latestPosts[d]);c.empty();c.append(e);try{c.listview("refresh")}catch(f){}},f=function(){$.mobile.showPageLoadingMsg();$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a);$.mobile.hidePageLoadingMsg();d()})};$(document).on("pageshow","#postsPage",function(){c=$("#postsList");b=$("#morePostsButton");
$.mobile.showPageLoadingMsg();$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a);$.mobile.hidePageLoadingMsg();b.show();d()});iLepra.getLastPosts();initCounters();$("#refreshPostsButton").bind(iLepra.config.defaultTapEvent,function(){$.mobile.showPageLoadingMsg();$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a);$.mobile.hidePageLoadingMsg();d()});iLepra.getLastPosts(!0)});b.bind(iLepra.config.defaultTapEvent,function(b){b.preventDefault();b.stopPropagation();
a<iLepra.latestPosts.length?(a+=a,d()):($.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a);$.mobile.hidePageLoadingMsg();d()}),iLepra.getMorePosts())});$("#layoutSelect").change(function(){switch($("#layoutSelect option:selected").val()){case "main":f();iLepra.switchLayout(1);break;case "all":f();iLepra.switchLayout(0);break;case "sub":f(),iLepra.switchLayout(2)}})});$(document).on(iLepra.config.defaultTapEvent,"a.postListItem",function(a){a.preventDefault();
a.stopPropagation();currentPostId=$(this).data("id");if("postsPage"==$.mobile.activePage.attr("id"))for(var b in iLepra.latestPosts){if(iLepra.latestPosts[b].id==currentPostId){iLepra.post.current=iLepra.latestPosts[b];break}}else if("mystuffPage"==$.mobile.activePage.attr("id"))for(b in iLepra.myStuffPosts){if(iLepra.myStuffPosts[b].id==currentPostId){iLepra.post.current=iLepra.myStuffPosts[b];break}}else if("inboxPage"==$.mobile.activePage.attr("id"))for(b in iLepra.inboxPosts){if(iLepra.inboxPosts[b].id==
currentPostId){iLepra.post.current=iLepra.inboxPosts[b];break}}else if("favsPage"==$.mobile.activePage.attr("id"))for(b in iLepra.favouritePosts){if(iLepra.favouritePosts[b].id==currentPostId){iLepra.post.current=iLepra.favouritePosts[b];break}}else if("subpostsPage"==$.mobile.activePage.attr("id"))for(b in iLepra.sub.posts)if(iLepra.sub.posts[b].id==currentPostId){iLepra.post.current=iLepra.sub.posts[b];break}$.mobile.changePage("post_full.html")});$(document).on("pagecreate","#fullPostPage",function(){$("#postContent").html(iLepra.post.current.body);
$("#postUser").text(iLepra.post.current.user);$("#postComments").text(iLepra.post.current.comments);$("#postTime").text(iLepra.post.current.when);$("#postRating").text(iLepra.post.current.rating)})})();
(function(){var a=!1,c=!1,b=iLepra.config.postIncrement,d="all",f=null,g=null,e=-1,h=null,j=null,i=function(){var a="";if("all"==d)for(var c=b>iLepra.post.comments.length?iLepra.post.comments.length:b,e=0;e<c;e++)a+=_.template(commentTemplate,iLepra.post.comments[e]);else if("new"==d){c=b>iLepra.post.newComments.length?iLepra.post.newComments.length:b;for(e=0;e<c;e++)a+=_.template(commentTemplate,iLepra.post.newComments[e])}h.empty();h.append(a);try{h.listview("refresh")}catch(f){}0<$(".new").length?
j.show():j.hide()},k=function(){$("#moreCommentsButton").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault();a.stopPropagation();b+=b;b>=iLepra.post.comments.length&&$("#commentsButtons").hide();h.empty();i();h.listview("refresh")});$("#allCommentsButton").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault();a.stopPropagation();b=iLepra.post.comments.length;$("#commentsButtons").hide();i()})};$(document).on("pagecreate","#fullPostPage",function(){b=iLepra.config.postIncrement;
h=$("#commentsList");j=$("#commentsNav");$("#postCommentsButton").bind(iLepra.config.defaultTapEvent,function(){a||($.mobile.showPageLoadingMsg(),a=!0,$(document).bind(iLepra.events.ready,function(c){$(document).unbind(c);$.mobile.hidePageLoadingMsg();$("#postCommentsButton").hide();$("#postCommentsContent").show();$("#replyPost").show();i();b>=iLepra.post.comments.length?$("#commentsButtons").hide():k();a=!1}),iLepra.post.getComments())});$("#allComments").bind(iLepra.config.defaultTapEvent,function(){$(this).addClass("ui-btn-active");
$("#newComments").removeClass("ui-btn-active");d="all";i()});$("#newComments").bind(iLepra.config.defaultTapEvent,function(){$(this).addClass("ui-btn-active");$("#allComments").removeClass("ui-btn-active");d="new";i()});$("#replyPost").bind(iLepra.config.defaultTapEvent,function(){c=!0;g=f=null;$.mobile.changePage("post_addcomment.html",{role:"dialog",transition:"slidedown",inline:"true"})});$("#prevnew").bind(iLepra.config.defaultTapEvent,function(){--e&&(e=0);var a=$($("ul#commentsList li.new")[e]);
null!=a&&$.mobile.silentScroll(a.offset().top)});$("#nextnew").bind(iLepra.config.defaultTapEvent,function(){var a=$("ul#commentsList li.new");++e>a.length-1&&(e=a.length-1);a=$(a[e]);null!=a&&$.mobile.silentScroll(a.offset().top)});$("#postVoteup").bind(iLepra.config.defaultTapEvent,function(){$(this).css("opacity",1);$(this).next().css("opacity",0.3);iLepra.post.votePost("p"+iLepra.post.current.id,"1")});$("#postVotedown").bind(iLepra.config.defaultTapEvent,function(){$(this).prev().css("opacity",
0.3);$(this).css("opacity",1);iLepra.post.votePost("p"+iLepra.post.current.id,"-1")});1==iLepra.post.current.vote?$("#postVoteup").css("opacity",1):-1==iLepra.post.current.vote&&$("#postVotedown").css("opacity",1);c&&($("#postCommentsButton").hide(),$("#postCommentsContent").show(),i(),b>=iLepra.post.comments.length?$("#commentsButtons").hide():k(),c=!1)});$(document).on(iLepra.config.defaultTapEvent,"div.commentsMenu a.reply",function(){c=!0;$.mobile.changePage("post_addcomment.html",{role:"dialog",
transition:"slidedown",inline:"true"})});$(document).on(iLepra.config.defaultTapEvent,"div.commentsMenu a.voteup",function(){$(this).css("opacity",1);$(this).next().css("opacity",0.3);iLepra.post.voteComment(f,"1")});$(document).on(iLepra.config.defaultTapEvent,"div.commentsMenu a.votedown",function(){$(this).prev().css("opacity",0.3);$(this).css("opacity",1);iLepra.post.voteComment(f,"-1")});$(document).on(iLepra.config.defaultTapEvent,"#commentsList li",function(a){a.preventDefault();f=$(this).data("id");
g=$(this).data("user");$(".commentsMenu").hide();a=$("div.commentsMenu",this);a.show();a=$(a.find("a")[1]);"inbox"==iLepra.post.current.type&&a.is(":visible")?a.hide().next().hide():a.is(":visible")||a.show().next().show()});$(document).on("pagecreate","#addCommentPage",function(){$("#submitComment").bind(iLepra.config.defaultTapEvent,function(){var a=$("#commentTextarea").val();$.mobile.showPageLoadingMsg();$(document).bind(iLepra.events.error,function(a){$(document).unbind(a);$(document).unbind(iLepra.events.ready);
$.mobile.hidePageLoadingMsg();iLepra.ui.showError("\u041e\u0448\u0438\u0431\u043a\u0430 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u044f! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437?")});$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a);$(document).unbind(iLepra.events.error);$.mobile.changePage("post_full.html")});iLepra.post.addComment(a,f)});null!=
g?$("#commentTextarea").val(g+": "):$("#commentTextarea").val("")})})();
(function(){$(document).on("pagecreate","#morePage",function(){updateNewsCounts();$("#favsButton").bind(iLepra.config.defaultTapEvent,function(){$.mobile.changePage("more_favs.html")});$("#myProfileButton").bind(iLepra.config.defaultTapEvent,function(){profileName=iLepra.username;$.mobile.changePage("more_profile.html")});$("#mySubsButton").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault();a.stopPropagation();iLepra.sub.list=iLepra.userSubLepras;iLepra.sub.fetch=!1;$.mobile.changePage("more_subs.html")});
$("#allSubsButton").bind(iLepra.config.defaultTapEvent,function(){iLepra.sub.fetch=!0;$.mobile.changePage("more_subs.html")});$("#govButton").bind(iLepra.config.defaultTapEvent,function(){$.mobile.changePage("more_gov.html")});$("#chatButton").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault();a.stopPropagation();$.mobile.changePage("more_chat.html")});$("#settingsButton").bind(iLepra.config.defaultTapEvent,function(){$.mobile.changePage("more_settings.html")})})})();
(function(){var a=iLepra.config.postIncrement,c=null,b=null;$(document).on("pageshow","#favsPage",function(){c=$("#favsList");b=$("#moreFavsButton");$.mobile.showPageLoadingMsg();$(document).bind(iLepra.events.ready,function(d){$(document).unbind(d);$.mobile.hidePageLoadingMsg().renderNewPosts();a<iLepra.favouritePosts.length&&(b.show(),b.bind(iLepra.config.defaultTapEvent,function(d){d.preventDefault();d.stopPropagation();a+=a;a>=iLepra.favouritePosts.length&&b.hide();for(var d="",g=a>iLepra.favouritePosts.length?
iLepra.favouritePosts.length:a,e=0;e<g;e++)d+=_.template(postTemplate,iLepra.favouritePosts[e]);c.empty();c.append(d);try{c.listview("refresh")}catch(h){}}))});iLepra.getFavourites()})})();var profileName;
(function(){$(document).on(iLepra.config.defaultTapEvent,"ul li.postInfo",function(){profileName=$(this).data("user");$.mobile.changePage("more_profile.html")});$(document).on("pageshow","#profilePage",function(){$.mobile.showPageLoadingMsg();$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a);$.mobile.hidePageLoadingMsg();$("#profileContent").show();a=iLepra.profile.data;$("#profileUsername").text(a.username);void 0!=a.userpic&&$("#userImage").attr("src",a.userpic);$("#fullName").text(a.fullName);
$("#userLocation").text(a.location);$("#userRegdate").html(a.regDate);$("#userNumber").text("\u041d\u043e\u043c\u0435\u0440; "+a.number);$("#userKarma").text("\u041a\u0430\u0440\u043c\u0430: "+a.karma);$("#userStat").text(a.userstat);var c=a.votestat.split("<br>");$("#userVote").html(c[0]);$("#userVoteCount").html(c[1]);$("#userDescription").html(a.description);var c=$("#contactsList"),b,d,f;for(b=0;b<a.contacts.length;b++)f=/href="(.+?)"/g.exec(a.contacts[b]),d=a.contacts[b].replace(/\s\s+/g," ").replace(/[\n\r]/g,
"").replace(/<.+?>/g,""),1<d.length&&(null!=f?c.append($('<li><a href="'+f[1]+'">'+d+"</a></li>")):c.append($("<li>"+d+"</li>")));c.listview("refresh")});iLepra.profile.getProfile(profileName)})})();
$(window).load(function(){var a=null,c=null,b=iLepra.config.postIncrement,d=null,f=null,g=null,e=function(){for(var a="",b=0;b<iLepra.sub.list.length;b++)a+=_.template(subsTemplate,iLepra.sub.list[b]);d.append(a);try{d.listview("refresh")}catch(c){}};$(document).on("pageshow","#subsPage",function(){d=$("#subsList");iLepra.sub.fetch?($.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a);$.mobile.hidePageLoadingMsg();e()}),iLepra.sub.getList()):e()});$(document).on(iLepra.config.defaultTapEvent,
"a.subListItem",function(){a=$(this).children("h1").text();c=$(this).data("link");$.mobile.changePage("more_subposts.html")});var h=function(){for(var a=b>iLepra.sub.posts.length?iLepra.sub.posts.length:b,c="",d=0;d<a;d++)c+=_.template(postTemplate,iLepra.sub.posts[d]);f.empty();f.append(c);try{f.listview("refresh")}catch(e){}};$(document).on("pageshow","#subpostsPage",function(){f=$("#subpostsList");g=$("#moreSubpostsButton");$.mobile.showPageLoadingMsg();$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a);
$.mobile.hidePageLoadingMsg();g.show();h()});iLepra.sub.getPosts(c);$("#subpostsTitle").text(a);g.bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault();a.stopPropagation();b<iLepra.sub.posts.length?(b+=b,h()):($.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a);$.mobile.hidePageLoadingMsg();h()}),iLepra.sub.getMorePosts(c))})})});
(function(){$(document).on("pageshow","#govPage",function(){$.mobile.showPageLoadingMsg();$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a);$.mobile.hidePageLoadingMsg();$("#president").html("<a href='#' class='username'>"+iLepra.gov.president+"</a> - "+iLepra.gov.time)});iLepra.gov.getCurrent()})})();
(function(){var a=null,c=null,b=null,d=null,f=function(){b.empty();var c="",d,f=a.length;for(d=0;d<f;d++)c+=_.template(chatTemplate,a[d]);b.append(c);b.listview("refresh")},g=function(b){$(document).bind(iLepra.events.ready,function(c){$(document).unbind(c);a=iLepra.chat.messages.slice(0);a.sort(function(a,b){return a.id>b.id?-1:1});f();"undefined"!=typeof b&&b&&$.mobile.hidePageLoadingMsg()});iLepra.chat.getMessages()};$(document).on("pageshow","#chatPage",function(){b=$("#chatList");d=$("#chatInput");
$("#submitChat").bind(iLepra.config.defaultTapEvent,function(){var b=d.val();d.val("");clearInterval(c);$.mobile.showPageLoadingMsg();$(document).bind(iLepra.events.ready,function(b){$(document).unbind(b);$.mobile.hidePageLoadingMsg();a=iLepra.chat.messages.slice(0);a.sort(function(a,b){return a.id>b.id?-1:1});f();c=setInterval("requestNewChatData()",1E4)});iLepra.chat.sendMessage(b)});$.mobile.showPageLoadingMsg();g(!0);c=setInterval("requestNewChatData()",1E4)});$(document).on("pagehide","#chatPage",
function(){clearInterval(c)});$(document).on(iLepra.config.defaultTapEvent,"li.chatMessage",function(){var a=$(this).data("user");d.val(a+": ")})})();
