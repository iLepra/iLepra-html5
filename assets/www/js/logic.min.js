var borderColors=["#000000","#660000","#cc3333","#663399","#0066cc","#66cccc","#669900","#666600","#cccc33","#ffcc33","#ff6600","#996633","#999999","#cccccc","#333333"],postTemplate='            <li data-icon="false">                <a href="#" class="postListItem" data-id="<%= id %>">                    <% if(text.length < 5 && iLepra.config.loadImages && image.length > 0){ %>                        <div>                            <img src="<%= image.replace("http://src.sencha.io/80/80/", "http://src.sencha.io/"+iLepra.config.screenBiggest+"/") %>" />                        </div>                    <% }else{ %>                        <% if(iLepra.config.loadImages && image.length > 0){ %>                            <img src="<%= image %>" class="postThumb" />                        <% } %>                        <h3 style="white-space:normal; font-weight:normal;"><%= text %></h3>                        <p><% if(domain_url != ""){ %><%= domain_url %> <% } %></p>                    <% } %>                </a>            </li>            <li data-role="list-divider" class="postInfo" data-user="<%= user %>">                <img />                <b><%= user %></b>,                 <span style="font-size:80%;">                <img src="../css/img/comment_16.png" class="iconImage" />                <% if(comments.indexOf("/") != -1){ %>                <b><%= comments %></b>,                <% }else{ %>                <%= comments %>,                <% } %>                <%= when %></span>                <% if(rating != undefined && rating.length > 0 && rating != 0){ %>,                     <span style="font-weight: bold; color:                     <% if( rating >= 0 ){ %>#157B25<% }else{ %>                        #824E48<% } %>                    "><%= rating %></span>                 <% } %>            </li>',subsTemplate='            <li>                <a href="#" class="subListItem" data-link="<%= link %>">                    <% if(iLepra.config.loadImages){ %><img src="<%= logo %>" class="postThumb" /><% } %>                    <h1><%= name %></h1>                    <p><%= creator %></p>                </a>            </li>',commentTemplate='            <li data-id="<%= id %>" data-user="<%= user %>" class="<%= newClass %>" <%= style %>>                <p class="commentText"><%= text %></p>                <div style="display:none;" class="commentsMenu">                    <a href="#" class="reply"><img src="../css/img/reply_32.png" /></a>                    <a href="#" class="voteup" style="float:right;                     <% if(vote == 1){ %>opacity: 1;<% }else{ %> opacity: 0.3; <% } %>                    "><img src="../css/img/voteup_32.png" /></a>                    <a href="#" class="votedown" style="float:right;                     <% if(vote == -1){ %>opacity: 1;<% }else{ %> opacity: 0.3; <% } %>                    "><img src="../css/img/votedown_32.png" /></a>                </div>            </li>            <li data-role="list-divider" class="postInfo" data-user="<%= user %>" <%= style %>>                <img />                <b><%= user %></b>,                 <%= when %></span>                <% if(rating != undefined && rating.length > 0 && rating != 0){ %>,                     <span style="font-weight: bold; color:                     <% if( rating >= 0 ){ %>#157B25<% }else{ %>                        #824E48<% } %>                    "><%= rating %></span>                 <% } %>            </li>',chatTemplate='            <li data-icon="false"  class="chatMessage commentText" data-user="<%= user_login %>">                <p class="commentText"><%= body %></p>            </li>            <li data-role="list-divider" class="postInfo">                <b><%= user_login %></b>,                 <%= createdate %></span>            </li>';(function(){function a(){var a=navigator.network.connection.type;return a==Connection.NONE||a==Connection.UNKNOWN?!1:!0}function b(){var a=device.version.split(".");return parseInt(a[0])<3?!0:!1}window.isOnline=a,window.isOldAndroid=b})(),document.addEventListener("deviceready",function(){$.support.cors=!0,$.mobile.allowCrossDomainPages=!0,$.mobile.pushStateEnabled=!1,$.mobile.loadingMessageTextVisible=!0,$.mobile.loadingMessage="Загружаемся ...",$.mobile.page.prototype.options.backBtnText="Назад",$.mobile.fixedtoolbar.prototype.options.tapToggle=!1;var a="";window.isOldAndroid()?($.mobile.defaultPageTransition="none",$.mobile.defaultDialogTransition="none",a="none"):($.mobile.defaultPageTransition="slide",a="fade"),$(document).on(iLepra.config.defaultTapEvent,"a",function(a){var b=$(this).data("url");if(b.indexOf("http://")!=-1){a.preventDefault(),a.stopImmediatePropagation(),window.open(b);return}});var b=function(b){typeof b=="undefined"&&(b=!1),$(document).bind(iLepra.events.ready,function(c){$(document).unbind(c);var d=b?"pages/":"";$.mobile.changePage(d+"posts.html",{transition:a})}),iLepra.getLastPosts()};$(document).bind(iLepra.events.init,function(c){$(document).unbind(c),iLepra.isAuthenticated?b(!0):$.mobile.changePage("pages/login.html",{transition:a})}),$(document).on("pagecreate","#loginPage",function(){if(iLepra.isAuthenticated){$.mobile.changePage("pages/posts.html",{transition:a});return}$("#captchaImage").attr("src",iLepra.captchaURL),$("#loginButton").bind(iLepra.config.defaultTapEvent,function(){$.mobile.showPageLoadingMsg();var a={user:$("#username").val(),pass:$("#pass").val(),captcha:$("#captcha").val().toLowerCase(),save:$("#rememberme").is(":checked")?1:0};$(document).bind(iLepra.events.error,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),iLepra.ui.showError(iLepra.errorMessage),$("#captchaImage").attr("src",iLepra.captchaURL)}),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$(document).unbind(iLepra.events.error),b()}),iLepra.tryLogin(a)})}),$(document).on("pagebeforeshow","#splashPage",function(){iLepra.isAuthenticated&&$.mobile.changePage("pages/posts.html",{transition:a})});var c=function(){window.isOnline()?iLepra.init():navigator.notification.alert("Для работы требуется подключение к интернету! Подключитесь и нажмите OK.",c,"Внимание!","ОК")};c()}),function(){var a=null,b=function(){if(a!=null){updateNewsCounts();return}a=setInterval(c,12e4),c()},c=function(){$(document).bind(iLepra.events.update,function(a){$(document).unbind(a),d()}),iLepra.getNewsCounters()},d=function(){var a=$(".inboxCounter"),b=$(".mystuffCounter"),c="";iLepra.inboxNewPosts>0?c+=iLepra.inboxNewPosts+"/"+iLepra.inboxNewComments:iLepra.inboxNewComments>0?c+=iLepra.inboxNewComments:c="",c!=""?(a.text(c),a.show()):a.hide();var d="";iLepra.myNewPosts>0?d+=iLepra.myNewPosts+"/"+iLepra.myNewComments:iLepra.myNewComments>0?d+=iLepra.myNewComments:d="",d!=""?(b.text(d),b.show()):b.hide()};window.initCounters=b,window.updateNewsCounts=d}(),function(){var a=function(a){$(a).parents("li").removeClass("ui-li-has-thumb"),$(a).parent().append("&nbsp;"),$(a).remove()};window.handleImageError=a}(),function(){var a=iLepra.config.postIncrement,b=null,c=null,d=!1,e=function(){var c=a>iLepra.myStuffPosts.length?iLepra.myStuffPosts.length:a,d="";for(var e=0;e<c;e++)d+=_.template(postTemplate,iLepra.myStuffPosts[e]);b.empty(),b.append(d);try{b.listview("refresh")}catch(f){}};$(document).on("pageshow","#mystuffPage",function(){d&&$.mobile.showPageLoadingMsg()}),$(document).on("pagebeforeshow","#mystuffPage",function(){b=$("#mystuffList"),c=$("#moreMystuffButton"),d=!0,$(document).bind(iLepra.events.ready,function(b){$(document).unbind(b),$.mobile.hidePageLoadingMsg(),d=!1,e(),a<iLepra.myStuffPosts.length&&(c.show(),c.bind(iLepra.config.defaultTapEvent,function(b){b.preventDefault(),b.stopPropagation(),a+=a,a>=iLepra.myStuffPosts.length&&c.hide(),e()}))}),iLepra.getMyStuff(),updateNewsCounts()})}(),function(){var a=iLepra.config.postIncrement,b=null,c=null,d=!1,e=function(){var c=a>iLepra.inboxPosts.length?iLepra.inboxPosts.length:a,d="";for(var e=0;e<c;e++)d+=_.template(postTemplate,iLepra.inboxPosts[e]);b.empty(),b.append(d);try{b.listview("refresh")}catch(f){}};$(document).on("pageshow","#inboxPage",function(){d&&$.mobile.showPageLoadingMsg()}),$(document).on("pagebeforeshow","#inboxPage",function(){b=$("#inboxList"),c=$("#moreInboxButton"),d=!0,$(document).bind(iLepra.events.ready,function(b){$(document).unbind(b),$.mobile.hidePageLoadingMsg(),d=!1,e(),a<iLepra.inboxPosts.length&&(c.show(),c.bind(iLepra.config.defaultTapEvent,function(b){b.preventDefault(),b.stopPropagation(),a+=a,a>=iLepra.inboxPosts.length&&c.hide(),e()}))}),iLepra.getInbox(),updateNewsCounts()})}(),function(){var a=iLepra.config.postIncrement,b=null,c=null,d=!1,e=function(){var c=a>iLepra.latestPosts.length?iLepra.latestPosts.length:a,d="";for(var e=0;e<c;e++)d+=_.template(postTemplate,iLepra.latestPosts[e]);b.empty(),b.append(d);try{b.listview("refresh")}catch(f){}},f=function(){$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),e()})};$(document).on("pageshow","#postsPage",function(a){d&&$.mobile.showPageLoadingMsg()}),$(document).on("pagebeforeshow","#postsPage",function(g){b=$("#postsList"),c=$("#morePostsButton"),d=!0,$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),d=!1,c.show(),e()}),iLepra.getLastPosts(),initCounters(),$("#refreshPostsButton").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault(),a.stopImmediatePropagation(),$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),e()}),iLepra.getLastPosts(!0)}),c.bind(iLepra.config.defaultTapEvent,function(b){b.preventDefault(),b.stopPropagation(),a<iLepra.latestPosts.length?(a+=a,e()):($.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),e()}),iLepra.getMorePosts())}),$("#layoutSelect").change(function(a){var b=$("#layoutSelect option:selected").val();switch(b){case"main":f(),iLepra.switchLayout(1);break;case"all":f(),iLepra.switchLayout(0);break;case"sub":f(),iLepra.switchLayout(2)}})}),$(document).on(iLepra.config.defaultTapEvent,"a.postListItem",function(a){a.preventDefault(),a.stopImmediatePropagation(),currentPostId=$(this).data("id");if($.mobile.activePage.attr("id")=="postsPage"){for(var b in iLepra.latestPosts)if(iLepra.latestPosts[b].id==currentPostId){iLepra.post.current=iLepra.latestPosts[b];break}}else if($.mobile.activePage.attr("id")=="mystuffPage"){for(var b in iLepra.myStuffPosts)if(iLepra.myStuffPosts[b].id==currentPostId){iLepra.post.current=iLepra.myStuffPosts[b];break}}else if($.mobile.activePage.attr("id")=="inboxPage"){for(var b in iLepra.inboxPosts)if(iLepra.inboxPosts[b].id==currentPostId){iLepra.post.current=iLepra.inboxPosts[b];break}}else if($.mobile.activePage.attr("id")=="favsPage"){for(var b in iLepra.favouritePosts)if(iLepra.favouritePosts[b].id==currentPostId){iLepra.post.current=iLepra.favouritePosts[b];break}}else if($.mobile.activePage.attr("id")=="subpostsPage")for(var b in iLepra.sub.posts)if(iLepra.sub.posts[b].id==currentPostId){iLepra.post.current=iLepra.sub.posts[b];break}$.mobile.changePage("post_full.html")}),$(document).on("pagecreate","#fullPostPage",function(){$("#postContent").html(iLepra.post.current.body),$("#postUser").text(iLepra.post.current.user),$("#postComments").text(iLepra.post.current.comments),$("#postTime").text(iLepra.post.current.when),$("#postRating").text(iLepra.post.current.rating)})}(),function(){var a=!1,b=iLepra.config.postIncrement,c="all",d=null,e=null,f=-1,g=null,h=null,i=null,j=null,k=null,l=function(){var a="";if(c=="all"){var d=b>iLepra.post.comments.length?iLepra.post.comments.length:b;for(var e=0;e<d;e++)a+=_.template(commentTemplate,iLepra.post.comments[e])}else if(c=="new"){var d=b>iLepra.post.newComments.length?iLepra.post.newComments.length:b;for(var e=0;e<d;e++)a+=_.template(commentTemplate,iLepra.post.newComments[e])}g.empty(),g.append(a);try{g.listview("refresh")}catch(f){}$(".new").length>0?h.show():h.hide()},m=function(){$("#moreCommentsButton").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault(),a.stopPropagation(),b+=b,b>=iLepra.post.comments.length&&$("#commentsButtons").hide(),g.empty(),l(),g.listview("refresh")}),$("#allCommentsButton").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault(),a.stopPropagation(),b=iLepra.post.comments.length,$("#commentsButtons").hide(),l()})};$(document).on("pagecreate","#fullPostPage",function(){b=iLepra.config.postIncrement,g=$("#commentsList"),h=$("#commentsNavBar"),i=$("#commentsNavButtons"),j=$("#commentsInputBar"),k=$("#commentInput"),$("#postCommentsButton").bind(iLepra.config.defaultTapEvent,n),$("#refreshComments").bind(iLepra.config.defaultTapEvent,n),$("#allComments").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault(),a.stopImmediatePropagation(),$(this).addClass("ui-btn-active"),$("#newComments").removeClass("ui-btn-active"),c="all",l()}),$("#newComments").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault(),a.stopImmediatePropagation(),$(this).addClass("ui-btn-active"),$("#allComments").removeClass("ui-btn-active"),c="new",l()}),$("#replyPost").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault(),a.stopImmediatePropagation(),d=null,e=null,o()}),$("#prevnew").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault(),a.stopImmediatePropagation(),--f&&(f=0);var b=$($("ul#commentsList li.new")[f]);b!=null&&$.mobile.silentScroll(b.offset().top)}),$("#nextnew").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault(),a.stopImmediatePropagation();var b=$("ul#commentsList li.new");++f>b.length-1&&(f=b.length-1);var c=$(b[f]);c!=null&&$.mobile.silentScroll(c.offset().top)}),$("#postVoteup").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault(),a.stopImmediatePropagation(),$(this).css("opacity",1),$(this).next().css("opacity",.6),iLepra.post.votePost("p"+iLepra.post.current.id,"1")}),$("#postVotedown").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault(),a.stopImmediatePropagation(),$(this).prev().css("opacity",.6),$(this).css("opacity",1),iLepra.post.votePost("p"+iLepra.post.current.id,"-1")}),$("#submitComment").bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault(),a.stopImmediatePropagation();var b=k.val();$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.error,function(a){$(document).unbind(a),$(document).unbind(iLepra.events.ready),$.mobile.hidePageLoadingMsg(),iLepra.ui.showError("Ошибка добавлени комментария! Попробуйте еще раз?")}),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$(document).unbind(iLepra.events.error),$.mobile.hidePageLoadingMsg(),k.val(""),i.show(),j.hide(),l()}),iLepra.post.addComment(b,d)}),iLepra.post.current.vote==1?$("#postVoteup").css("opacity",1):iLepra.post.current.vote==-1&&$("#postVotedown").css("opacity",1)}),$(document).on(iLepra.config.defaultTapEvent,"div.commentsMenu a.reply",function(a){a.preventDefault(),a.stopImmediatePropagation(),o()}),$(document).on(iLepra.config.defaultTapEvent,"div.commentsMenu a.voteup",function(a){a.preventDefault(),a.stopImmediatePropagation(),$(this).css("opacity",1),$(this).next().css("opacity",.3),iLepra.post.voteComment(d,"1")}),$(document).on(iLepra.config.defaultTapEvent,"div.commentsMenu a.votedown",function(a){a.preventDefault(),a.stopImmediatePropagation(),$(this).prev().css("opacity",.3),$(this).css("opacity",1),iLepra.post.voteComment(d,"-1")}),$(document).on(iLepra.config.defaultTapEvent,"#commentsList li",function(a){a.preventDefault(),a.stopImmediatePropagation(),d=$(this).data("id"),e=$(this).data("user"),$(".commentsMenu").hide();var b=$("div.commentsMenu",this);b.show();var c=$(b.find("a")[1]);iLepra.post.current.type=="inbox"&&c.is(":visible")?c.hide().next().hide():c.is(":visible")||c.show().next().show()});var n=function(c){c.preventDefault(),c.stopImmediatePropagation();if(a)return;$.mobile.showPageLoadingMsg(),a=!0,$(document).bind(iLepra.events.ready,function(c){$(document).unbind(c),$.mobile.hidePageLoadingMsg(),$("#postCommentsButton").hide(),$("#postCommentsContent").show(),$("#replyPost").show(),l(),b>=iLepra.post.comments.length?$("#commentsButtons").hide():m(),a=!1}),iLepra.post.getComments()},o=function(){h.show(),i.hide(),j.show(),e!=null?k.val(e+": "):k.val("")}}(),function(){var a=null,b=!1,c=function(){$("li.active").each(function(){$(this).removeClass("active")})};window.clearActiveMenu=c;var d=function(a,b){a.preventDefault(),a.stopImmediatePropagation(),c(),$(b).parent().addClass("active")},e=function(){b=!1,a.hide()},f=function(){b=!0},g=function(a){$(".ui-page-active").transition({marginLeft:"0px"},150,function(){e(),$.mobile.changePage(a,{transition:"none"})})};$(document).on("pagecreate","#splashPage",function(){a=$("#menu"),$(document).on(iLepra.config.defaultTapEvent,"a.showMenu",function(){return b!=!0?(a.show(),a.css("top",$(window).scrollTop()+"px"),window.isOldAndroid()?($(".ui-page-active").css("marginLeft","165px"),f()):$(".ui-page-active").transition({marginLeft:"165px"},300,f),!1):(window.isOldAndroid()?($(".ui-page-active").css("marginLeft","0px"),e()):$(".ui-page-active").transition({marginLeft:"0px"},300,e),!1)}),$("#postsButton").bind(iLepra.config.defaultTapEvent,function(a){d(a,this),g("posts.html")}),$("#mystuffButton").bind(iLepra.config.defaultTapEvent,function(a){d(a,this),g("mystuff.html")}),$("#inboxButton").bind(iLepra.config.defaultTapEvent,function(a){d(a,this),g("inbox.html")}),$("#favsButton").bind(iLepra.config.defaultTapEvent,function(a){d(a,this),g("more_favs.html")}),$("#myProfileButton").bind(iLepra.config.defaultTapEvent,function(a){d(a,this),profileName=iLepra.username,g("more_profile.html")}),$("#mySubsButton").bind(iLepra.config.defaultTapEvent,function(a){d(a,this),iLepra.sub.list=iLepra.userSubLepras,iLepra.sub.fetch=!1,g("more_subs.html")}),$("#allSubsButton").bind(iLepra.config.defaultTapEvent,function(a){d(a,this),iLepra.sub.fetch=!0,g("more_subs.html")}),$("#govButton").bind(iLepra.config.defaultTapEvent,function(a){d(a,this),g("more_gov.html")}),$("#chatButton").bind(iLepra.config.defaultTapEvent,function(a){d(a,this),g("more_chat.html")}),$("#settingsButton").bind(iLepra.config.defaultTapEvent,function(a){d(a,this),g("more_settings.html")}),$("#logoutButton").bind(iLepra.config.defaultTapEvent,function(a){d(a,this),$(".ui-page-active").animate({marginLeft:"0px"},300,e),$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(){$.mobile.changePage("login.html")}),iLepra.doLogout()})})}(),function(){var a=iLepra.config.postIncrement,b=null,c=null,d=!1,e=function(){var c="",d=a>iLepra.favouritePosts.length?iLepra.favouritePosts.length:a;for(var e=0;e<d;e++)c+=_.template(postTemplate,iLepra.favouritePosts[e]);b.empty(),b.append(c);try{b.listview("refresh")}catch(f){}};$(document).on("pageshow","#favsPage",function(){d&&$.mobile.showPageLoadingMsg()}),$(document).on("pagebeforeshow","#favsPage",function(){b=$("#favsList"),c=$("#moreFavsButton"),d=!0,$(document).bind(iLepra.events.ready,function(b){$(document).unbind(b),$.mobile.hidePageLoadingMsg(),d=!1,e(),a<iLepra.favouritePosts.length&&(c.show(),c.bind(iLepra.config.defaultTapEvent,function(b){b.preventDefault(),b.stopPropagation(),a+=a,a>=iLepra.favouritePosts.length&&c.hide(),e()}))}),iLepra.getFavourites()})}();var profileName;(function(){var a=!1;$(document).on(iLepra.config.defaultTapEvent,"ul li.postInfo",function(a){a.preventDefault(),a.stopImmediatePropagation(),profileName=$(this).data("user"),$.mobile.changePage("more_profile.html")}),$(document).on("pageshow","#profilePage",function(){a&&$.mobile.showPageLoadingMsg()}),$(document).on("pagebeforeshow","#profilePage",function(){a=!0,$(document).bind(iLepra.events.ready,function(b){$(document).unbind(b),$.mobile.hidePageLoadingMsg(),a=!1,$("#profileContent").show();var c=iLepra.profile.data;$("#profileUsername").text(c.username),c.userpic!=undefined&&$("#userImage").attr("src",c.userpic),$("#fullName").text(c.fullName),$("#userLocation").text(c.location),$("#userRegdate").html(c.regDate),$("#userNumber").text("Номер; "+c.number),$("#userKarma").text("Карма: "+c.karma),$("#userStat").text(c.userstat);var d=c.votestat.split("<br>");$("#userVote").html(d[0]),$("#userVoteCount").html(d[1]),$("#userDescription").html(c.description);var e=$("#contactsList"),f,g,h;for(f=0;f<c.contacts.length;f++)h=/href="(.+?)"/g.exec(c.contacts[f]),g=c.contacts[f].replace(/\s\s+/g," ").replace(/[\n\r]/g,"").replace(/<.+?>/g,""),g.length>1&&(h!=null?e.append($('<li><a href="'+h[1]+'">'+g+"</a></li>")):e.append($("<li>"+g+"</li>")));e.listview("refresh")}),iLepra.profile.getProfile(profileName)})})(),$(window).load(function(){var a=null,b=null,c=iLepra.config.postIncrement,d=!1,e=null,f=null,g=null,h=function(){var a="";for(var b=0;b<iLepra.sub.list.length;b++)a+=_.template(subsTemplate,iLepra.sub.list[b]);e.append(a);try{e.listview("refresh")}catch(c){}};$(document).on("pageshow","#subsPage",function(){d&&$.mobile.showPageLoadingMsg()}),$(document).on("pagebeforeshow","#subsPage",function(){e=$("#subsList"),iLepra.sub.fetch?(d=!0,$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),d=!1,h()}),iLepra.sub.getList()):h()}),$(document).on(iLepra.config.defaultTapEvent,"a.subListItem",function(c){c.preventDefault(),c.stopImmediatePropagation(),a=$(this).children("h1").text(),b=$(this).data("link"),$.mobile.changePage("more_subposts.html")});var i=function(){var a=c>iLepra.sub.posts.length?iLepra.sub.posts.length:c,b="";for(var d=0;d<a;d++)b+=_.template(postTemplate,iLepra.sub.posts[d]);f.empty(),f.append(b);try{f.listview("refresh")}catch(e){}};$(document).on("pagebeforeshow","#subpostsPage",function(){d&&$.mobile.showPageLoadingMsg()}),$(document).on("pagebeforeshow","#subpostsPage",function(){f=$("#subpostsList"),g=$("#moreSubpostsButton"),d=!0,$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),d=!1,g.show(),i()}),iLepra.sub.getPosts(b),$("#subpostsTitle").text(a),g.bind(iLepra.config.defaultTapEvent,function(a){a.preventDefault(),a.stopPropagation(),c<iLepra.sub.posts.length?(c+=c,i()):($.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),i()}),iLepra.sub.getMorePosts(b))})})}),function(){var a=!1;$(document).on("pageshow","#govPage",function(){a&&$.mobile.showPageLoadingMsg()}),$(document).on("pagebeforeshow","#govPage",function(){a=!0,$(document).bind(iLepra.events.ready,function(b){$(document).unbind(b),$.mobile.hidePageLoadingMsg(),a=!1,$("#president").html("<a href='#' class='username'>"+iLepra.gov.president+"</a> - "+iLepra.gov.time)}),iLepra.gov.getCurrent()})}(),function(){var a=null,b=null,c=!1,d=null,e=null,f=64,g=function(){d.empty();var b="",c,e=a.length>f?f:a.length;for(c=0;c<e;c++)b+=_.template(chatTemplate,a[c]);d.append(b),d.listview("refresh")},h=function(b){$(document).bind(iLepra.events.ready,function(d){$(document).unbind(d),a=iLepra.chat.messages.slice(0),a.sort(function(a,b){return a.id>b.id?-1:1}),g(),typeof b!="undefined"&&b&&($.mobile.hidePageLoadingMsg(),c=!1)}),iLepra.chat.getMessages()};$(document).on("pageshow","#chatPage",function(){c&&$.mobile.showPageLoadingMsg()}),$(document).on("pagebeforeshow","#chatPage",function(){d=$("#chatList"),e=$("#chatInput"),c=!0,$("#submitChat").bind(iLepra.config.defaultTapEvent,function(c){c.preventDefault(),c.stopImmediatePropagation();var d=e.val();e.val(""),clearInterval(b),$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(c){$(document).unbind(c),$.mobile.hidePageLoadingMsg(),a=iLepra.chat.messages.slice(0),a.sort(function(a,b){return a.id>b.id?-1:1}),g(),b=setInterval("requestNewChatData()",1e4)}),iLepra.chat.sendMessage(d)}),h(!0),b=setInterval("requestNewChatData()",1e4)}),$(document).on("pagehide","#chatPage",function(){clearInterval(b)}),$(document).on(iLepra.config.defaultTapEvent,"li.chatMessage",function(a){a.preventDefault(),a.stopImmediatePropagation();var b=$(this).data("user");e.val(b+": ")})}()